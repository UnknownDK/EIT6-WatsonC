#include "stdio.h"
#include "ezdsp5535.h"  // board header
#include "csl_intc.h"
#include "ezdsp5535_gpio.h"

// Audio codec setup
#include "aic3204.h"        // codec header
Uint16 sample_rate = 48000; // sample rate
Int16 gain_db = 0;         // gain on input (-1 er korrekt)
Int16 r, l;               // store read-values
//

// Declare functions
void pedal_init(Uint16 SAMPLE_RATE, Int16 GAIN_DB);    // init board and codec
void GPIO_test_init();
void overdrive(Int16 *left, Int16 *right);
    Int16 gain_overdrive, th_soft_overdrive, th_hard_overdrive;
//

////////////////// main.c ///////////////////////////////
int main(void)
 {
    // setup
    pedal_init(sample_rate, gain_db);   // init board and codec
    // GPIO_test_init();

    // main loop
    while(1)
    {
        //ezdsp5535_GPIO_setOutput(GPIO13, 1); // test high pin 4

        aic3204_codec_read(&l, &r);
        //printf("Venstre: %u \n", l);
        //printf("Højre: %u \n", r);
        aic3204_codec_write(l, r);

        //ezdsp5535_GPIO_setOutput(GPIO13, 0); // test low pin 4
    }
}


///////////////////// Functions ///////////////////////////
void pedal_init(Uint16 SAMPLE_RATE, Int16 GAIN_DB)
{
    // eZdsp - dev board
    ezdsp5535_init();

    // AIC3204 - audio codec
    aic3204_hardware_init();
    aic3204_init();
    set_sampling_frequency_and_gain(SAMPLE_RATE, GAIN_DB);  // Sets samplerate and gain on input
}

void GPIO_test_init()
{
    ezdsp5535_GPIO_init();
    ezdsp5535_GPIO_setDirection(GPIO13, GPIO_OUT);
}

void overdrive(Int16 *left, Int16 *right)
{
    if( abs(*left) > th_soft_overdrive){ // soft-clip
        if(*left > 0){

        }
        if(*left <= 0){

        }
    }
    if( abs(*left) > th_hard_overdrive){ // hard-clip

    }
    else;
}
